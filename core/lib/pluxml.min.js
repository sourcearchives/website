function dateNow(field,delta){var d=new Date();var utc=d.getTime()+(d.getTimezoneOffset()*60000);var now=new Date(utc+(1000*delta));var y=now.getFullYear();var m=now.getMonth();var d=now.getDate();var h=now.getHours();var i=now.getMinutes();if(i<=9){i='0'+i;}
if(h<=9){h='0'+h;}
if(d<=9){d='0'+d;}
m=m+1;if(m<=9){m='0'+m;}
document.getElementsByName(field+'_day')['0'].value=d;document.getElementsByName(field+'_time')['0'].value=h+":"+i;document.getElementsByName(field+'_month')['0'].value=m;document.getElementsByName(field+'_year')['0'].value=y;}
function answerCom(where,id,author){document.getElementById('id_parent').value=id;scrollTo(0,0);}
function addText(where,open,close){close=close==undefined?'':close;var formfield=document.getElementsByName(where)['0'];if(document.selection&&document.selection.createRange){formfield.focus();sel=document.selection.createRange();sel.text=open+sel.text+close;formfield.focus();}
else if(formfield.selectionStart||formfield.selectionStart=='0'){var startPos=formfield.selectionStart;var endPos=formfield.selectionEnd;var restoreTop=formfield.scrollTop;formfield.value=formfield.value.substring(0,startPos)+open+formfield.value.substring(startPos,endPos)+close+formfield.value.substring(endPos,formfield.value.length);formfield.selectionStart=formfield.selectionEnd=endPos+open.length+close.length;if(restoreTop>0)formfield.scrollTop=restoreTop;formfield.focus();}
else{formfield.value+=open+close;formfield.focus();}
return;}
function checkAll(inputs,field){for(var i=0;i<inputs.elements.length;i++){if(inputs[i].type=="checkbox"&&inputs[i].name==field){inputs[i].checked=!inputs[i].checked;}}}
function confirmAction(inputs,selfield,selvalue,field,msg){if(document.getElementById(selfield).value==selvalue){var action=false;for(var i=0;i<inputs.elements.length;i++){if(inputs[i].type=="checkbox"&&inputs[i].name==field){if(inputs[i].checked){action=true}}}
return(action?confirm(msg):false);}}
function toggleDiv(divId,togglerId,on,off){var toggler=document.getElementById(togglerId);if(document.getElementById(divId).style.display=='none'){document.getElementById(divId).style.display='block';toggler.innerHTML=off;}else{document.getElementById(divId).style.display='none';toggler.innerHTML=on;}}
function insTag(where,tag){var formfield=document.getElementsByName(where)['0'];if(formfield.value=='')
formfield.value=tag;else
formfield.value=formfield.value+', '+tag;}var popupCss='.aside { display: none;}.section .action-bar { left: 0; right: 0; margin-right: 0; margin-left: 0;}@media (min-width: 768px) { .col.lrg-offset-2 {  margin-left: 10px;  margin-right: 20px;  width: 100%; }}';var mediasManager={addText:function(cibleId,txt,replace){var txt=txt.replace(this.opts.racine,'');var cible=window.opener.document.getElementById(cibleId);if(cible){cible.focus();if(replace){cible.value=txt;}else{if(window.opener.document.selection&&window.opener.document.selection.createRange){sel=window.opener.document.selection.createRange();sel.text=sel.text+txt;}
else if(cible.selectionStart||cible.selectionStart=='0'){var startPos=cible.selectionStart;var endPos=cible.selectionEnd;var restoreTop=cible.scrollTop;cible.value=cible.value.substring(0,startPos)+txt+cible.value.substring(startPos,endPos)+cible.value.substring(endPos,cible.value.length);cible.selectionStart=cible.selectionEnd=endPos+txt.length;if(restoreTop>0)cible.scrollTop=restoreTop;}
else{cible.value+=txt;}}
cible.focus();}else{console.log('Element #'+cibleId+' introuvable - '+txt);}
return false;},updImg:function(cibleId,imgPath){var id=window.opener.document.getElementById(cibleId);if(id){id.innerHTML='<img src="'+imgPath+'" alt="" />';}},construct:function(options){this.opts=options;if(window.name==this.opts.windowName){var textNode=document.createTextNode(popupCss);var style=document.createElement('style');style.setAttribute('type','text/css');style.appendChild(textNode);document.getElementsByTagName('head')[0].appendChild(style);var tbody=document.querySelector('#medias-table tbody');if(tbody){tbody.addEventListener('click',function(event){var target=event.target;if(target.tagName=='A'){event.preventDefault();var launcher=window.opener.mediasManager;var replace=launcher.replace;var cibleId=launcher.cibleId;var fallback=launcher.fallback;var fn=window[fallback];window.close();if(typeof fn==="function"){var fnparams=[cibleId,target.href,replace];fn.apply(null,fnparams);}else{mediasManager.addText(cibleId,target.href,replace);mediasManager.updImg(cibleId+'_img',target.href);}
cibleId.focus();}});}}},openPopup:function(cibleId,replace,fallback){var replace=replace==undefined?false:true;var width=this.opts.width?this.opts.width:950;var height=this.opts.height?this.opts.height:580;var left=parseInt((screen.width-width)/ 2);var top=parseInt((screen.height-height)/ 2);var options='directories=no, toolbar=no, menubar=no, location=no, resizable=yes, scrollbars=yes, width='+width+' , height='+height+', left='+left+', top='+top;this.cibleId=cibleId;this.replace=replace;this.fallback=fallback;popup=window.open(unescape(this.opts.racine+this.opts.urlManager),this.opts.windowName,options);if(popup){popup.focus();}else{alert('Ouverture de la fenêtre bloquée par un anti-popup!');}
return false;}}var nfiles=0;var MultiSelector={init:function(){this.count=0;this.files_list=document.getElementById("files_list");this.selector=document.getElementById("selector_0");if(this.selector)this.selector.addEventListener("change",this,false);},handleEvent:function(e){switch(e.type){case"change":e.stopPropagation();e.preventDefault();this.handleChange();break;}},handleChange:function(){this.selector=document.getElementById("selector_"+this.count++);this.selector.style.position='absolute';this.selector.style.left='-1000px';var new_element=document.createElement('input');new_element.type="file";new_element.multiple="multiple";new_element.id="selector_"+this.count;new_element.name="selector_"+this.count+"[]";new_element.addEventListener("change",this,false);this.selector.parentNode.insertBefore(new_element,this.selector)
for(i=0;i<this.selector.files.length;i++){this.addListRow(this.selector,(this.count-1)+'_'+i,this.selector.files[i].name);this.selector.parentNode.insertBefore(new_element,this.selector);}},addListRow:function(element,i,filename){var new_row=document.createElement('div');new_row.setAttribute("id","rowfile_"+i);new_row.setAttribute("class","rowfile");new_row.setAttribute("className","rowfile");new_hidden=document.createElement('input');new_hidden.type="checkbox";new_hidden.name="myfiles[]";new_hidden.checked="checked";new_hidden.value=i;new_hidden.style.position='absolute';new_hidden.style.left='-1000px';var new_lnkDelete=document.createElement('a');new_lnkDelete.setAttribute('href','javascript:void(0)');new_lnkDelete.innerHTML='&#10006';new_lnkDelete.setAttribute("class","btnDelete");new_lnkDelete.setAttribute("className","btnDelete");var new_row_div=document.createElement('div');new_row_div.innerHTML='&nbsp;'+this.basename(filename);new_row_div.setAttribute("class","divtitle");new_row_div.setAttribute("className","divtitle");new_row.element=element;new_lnkDelete.onclick=function(){var div=document.getElementById('rowfile_'+i);div.parentNode.removeChild(div);nfiles--;}
new_row.appendChild(new_hidden);new_row.appendChild(new_lnkDelete);new_row.appendChild(new_row_div);this.files_list.appendChild(new_row);nfiles++;},basename:function(path){return path.replace(/\\/g,'/').replace(/.*\//,'');}};MultiSelector.init();function setOpacity(obj,opacity){obj.style.minHeight=obj.style.minHeight;opacity=(opacity==100)?99.999:opacity;obj.style.filter="alpha(opacity="+opacity+")";obj.style.KHTMLOpacity=opacity/100;obj.style.MozOpacity=opacity/100;obj.style.opacity=opacity/100;}
function fadeOut(objId,opacity){var obj=document.getElementById(objId);if(obj){if(opacity==undefined){window.setTimeout("fadeOut('"+objId+"',"+100+")",3000);}else{if(opacity>=0){setOpacity(obj,opacity);opacity-=10;window.setTimeout("fadeOut('"+objId+"',"+opacity+")",100);}else{obj.style.display='none';}}}}
function setMsg(){if(document.getElementById('msg')){objDiv=document.getElementById('msg');objSidebar=document.getElementById('sidebar')
if(typeof window.innerWidth!='undefined'){wndWidth=window.innerWidth;}
else if(typeof document.documentElement!='undefined'&&typeof document.documentElement.clientWidth!='undefined'&&document.documentElement.clientWidth!=0){wndWidth=document.documentElement.clientWidth;}
else{wndWidth=document.getElementsByTagName('body')[0].clientWidth;}
xpos=Math.round((wndWidth-objDiv.offsetWidth)/2);objDiv.style.left=xpos+'px';fadeOut('msg');}}